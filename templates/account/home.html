{% extends "account.html" %}
{% load staticfiles %}
{% load account_tags %}

{% block sub_head %}
    <meta http-equiv="refresh" content="60">
    <link href="{% static "css/account.css" %}" rel="stylesheet">
{% endblock %}

{% block account %}

    <div class="row">
        <div class="text-center">
            <h1 class="{{ balance.c_pos|get_account_class }}" style="margin-bottom: 0;">Total: ${{ balance.value }}</h1>
            <h3 class="{{ balance.c_pos|get_account_class }}" style="margin-top: 0; margin-bottom: 0;">
                Change: ${{ balance.c_tot }} (%{{ balance.c_per }})
            </h3>
            <h5 style="margin-top: 3px;">
                <span class="{{ balance.p_pos|get_account_class }}">
                    Yesterday: ${{ balance.p_tot }} (%{{ balance.p_per }})
                </span>
                <span class="text-info">
                    <a href="https://grafana.cssnr.com/dashboard/db/gdax-total?var-account={{ request.user.username|user_display }}" target="_blank">
                        View Graph <i class="fa fa-area-chart" aria-hidden="true"></i>
                    </a>
                </span>
            </h5>
        </div>

        <img class="img-responsive center-block" src="https://grafana.cssnr.com/render/dashboard-solo/db/gdax-total?var-account={{ request.user.username|user_display }}&panelId=2&width=500&height=300" />

        <table class="table table-hover table-condensed table-striped">
            <tr>
                <th>Account</th><th>Balance</th><th>USD Value</th>
            </tr>
            {% for account in accounts %}
                <tr>
                    <td>{{ account.currency }}</td>
                    <td>{{ account.balance|trim_balance:6 }}</td>
                    <td>${{ account.value }}</td>
                </tr>
            {% endfor %}
        </table>

        <p class="text-center">
            Updated: <strong>{% now "M jS \a\t g:i A T" %}</strong>
            <br>
            Time Since Last Refresh: <label id="minutes">00</label>:<label id="seconds">00</label>
        </p>

        {% if messages %}
            <hr>
            <div id="messages">
                <p></p>
                <ul class="list-group text-center">
                    {% for message in messages %}
                        <li class="list-group-item list-group-item-{{ message.extra_tags }}">
                            {{ message }}
                        </li>
                    {% endfor %}
                </ul>
            </div>
        {% endif %}

        <hr>

        <a href="." class="btn btn-block btn-lg btn-success center-block" role="button">
            Refresh Now <i class="fa fa-refresh" aria-hidden="true"></i>
        </a>

        <p class="text-center"><small>Page automatically refreshes every 60 seconds.</small></p>

    </div>

{% endblock %}
